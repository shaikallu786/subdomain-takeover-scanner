<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subdomain Scanner Dashboard</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22c55e;
      --danger: #ef4444;
      --border: #1f2937;
    }
    body { font-family: Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
    .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    .header { display: flex; align-items: baseline; justify-content: space-between; gap: 16px; }
    .title { font-size: 22px; font-weight: 700; }
    .meta { color: var(--muted); font-size: 14px; }
    .stats { display: flex; gap: 10px; margin-top: 8px; }
    .chip { background: var(--card); border: 1px solid var(--border); padding: 6px 10px; border-radius: 999px; font-size: 12px; }
    .chip strong { margin-right: 6px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 12px; margin-top: 16px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border-bottom: 1px solid var(--border); padding: 10px 8px; text-align: left; }
    th { color: var(--muted); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: .04em; }
    tr:hover td { background: rgba(255,255,255,0.02); }
    .badge { display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 12px; font-weight: 600; }
    .badge.high { background: rgba(239,68,68,.15); color: #fecaca; border: 1px solid rgba(239,68,68,.4); }
    .badge.low { background: rgba(34,197,94,.15); color: #bbf7d0; border: 1px solid rgba(34,197,94,.4); }
    .muted { color: var(--muted); }
    .toolbar { display: flex; gap: 10px; align-items: center; }
    a { color: #60a5fa; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="header">
    <div class="title">Subdomain Takeover Scanner</div>
    <div class="toolbar meta">
      <span>Last run: <strong>{{ scans.last_run }}</strong></span>
      <span class="chip"><strong>Auto-refresh</strong> 15s</span>
      <a href="/logs/" title="Open logs directory">Logs</a>
    </div>
  </div>

  <div class="stats">
    <div class="chip"><strong>Total</strong> {{ scans.results|length }}</div>
    <div class="chip"><strong>High risk</strong> {{ scans.results|selectattr('risk', 'equalto', 'High')|list|length }}</div>
    <div class="chip"><strong>Low risk</strong> {{ scans.results|selectattr('risk', 'equalto', 'Low')|list|length }}</div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Domain</th>
          <th>CNAME / Canonical</th>
          <th>Risk</th>
          <th>Checked At</th>
        </tr>
      </thead>
      <tbody>
      {% for r in scans.results %}
        <tr>
          <td>{{ r.domain }}</td>
          <td class="muted">{{ r.cname or "-" }}</td>
          <td>
            {% if r.risk == "High" %}
              <span class="badge high">HIGH</span>
            {% else %}
              <span class="badge low">LOW</span>
            {% endif %}
          </td>
          <td class="muted">{{ r.checked_at }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="muted">No results yet.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <script>
    setInterval(function () { location.reload(); }, 15000);
  </script>
</body>
</html>